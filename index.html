<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AutoResident</title>
  <style>
    :root {
      --bg: #0b0b0b;
      --card: #141414;
      --brand: #ff7b00;
      --brand-soft: #ff9d2b;
      --text: #f2f2f2;
      --muted: #a1a1a1;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif; }
    .screen {
      position: relative;
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: 20px;
      overflow: hidden;
    }
    .hero {
      position: relative;
      width: min(980px, 92vw);
      display: grid;
      gap: 20px;
      justify-items: center;
      text-align: center;
      animation: fadeIn .9s ease both;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .logo-wrap {
      position: relative;
      display: grid;
      place-items: center;
      width: clamp(180px, 28vw, 320px);
      aspect-ratio: 1/1;
    }
    .logo-wrap::before {
      content: "";
      position: absolute;
      inset: -12%;
      border-radius: 50%;
      background: radial-gradient(closest-side, rgba(255,123,0,.35), rgba(255,123,0,.18) 45%, rgba(255,123,0,0) 70%);
      opacity: 0;
      animation: glow 1.8s ease-out forwards;
    }
    @keyframes glow { 
      0% { opacity: 0; filter: blur(22px); transform: scale(.85); }
      60% { opacity: 1; filter: blur(28px); transform: scale(1.02); }
      100% { opacity: .9; filter: blur(26px); transform: scale(1); }
    }
    .logo {
      width: 78%;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 0 0 rgba(0,0,0,0);
      animation: logoIn 1.1s ease-out both .1s;
    }
    @keyframes logoIn { from { opacity: 0; transform: scale(.94); } to { opacity: 1; transform: scale(1); } }
    h1 { margin: 0; font-size: clamp(22px, 3vw, 34px); color: var(--brand); letter-spacing: .5px; }
    p.tagline { margin: 0; color: var(--muted); max-width: 760px; }
    .actions { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin-top: 8px; }
    .btn {
      background: var(--brand);
      color: #fff;
      border: none;
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: transform .12s ease, background .2s ease;
    }
    .btn:hover { transform: translateY(-1px); background: var(--brand-soft); }
    .partners {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }
    .partner {
      position: absolute;
      display: grid;
      place-items: center;
      background: #121212;
      border: 1px solid #2a2a2a;
      border-radius: 50%;
      color: #eaeaea;
      text-decoration: none;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      opacity: 0;
      transform: translateY(8px) scale(.92);
      animation: popIn .8s ease forwards;
    }
    .partner:hover::after {
      content: attr(data-tip);
      position: absolute;
      bottom: calc(100% + 8px);
      white-space: nowrap;
      background: #101010;
      color: #fff;
      border: 1px solid #2a2a2a;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,.35);
      pointer-events: none;
    }
    @keyframes popIn { to { opacity: 1; transform: translateY(0) scale(1); } }
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,.6); display: none; place-items: center; z-index: 30;
    }
    .modal { background: var(--card); border: 1px solid #2a2a2a; border-radius: 14px; width: min(640px, 92vw); padding: 18px; }
    .modal h3 { margin: 0 0 8px; color: var(--brand); }
    label { display:block; margin: 10px 0 4px; color: var(--brand-soft); }
    input, select, textarea { width: 100%; background: #0f0f0f; border: 1px solid #2a2a2a; color: #fff; padding: 10px; border-radius: 10px; }
    .modal .actions { justify-content: flex-end; margin-top: 12px; }
    .close { background: transparent; border: 1px solid #2a2a2a; color: #ddd; }
    body, .screen { overflow: hidden; }
  </style>
</head>
<body>
  <main class="screen">
    <div class="partners" id="partners"></div>

    <section class="hero">
      <div class="logo-wrap">
        <img class="logo" src="logo.jpg" alt="AutoResident Logo"/>
      </div>
      <h1>AutoResident Co.</h1>
      <p class="tagline">–ú–µ—Å—Ç–æ, –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Ç–µ, –∫—Ç–æ –∏—â–µ—Ç –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏.</p>
      <div class="actions">
        <button class="btn" id="findBtn">üîç –•–æ—á—É –Ω–∞–π—Ç–∏ –∞–≤—Ç–æ</button>
        <button class="btn" id="offerBtn">üöó –•–æ—á—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–≤—Ç–æ</button>
      </div>
    </section>
  </main>

  <div class="modal-backdrop" id="searchModal">
    <div class="modal">
      <h3>–ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h3>
      <label>–ú–∞—Ä–∫–∞</label>
      <input id="brand" placeholder="Hyundai, BMW..."/>
      <label>–¢–∏–ø –ö–ü–ü</label>
      <select id="transmission">
        <option value="">–õ—é–±–æ–π</option>
        <option value="–∞–≤—Ç–æ–º–∞—Ç">–ê–≤—Ç–æ–º–∞—Ç</option>
        <option value="–º–µ—Ö–∞–Ω–∏–∫–∞">–ú–µ—Ö–∞–Ω–∏–∫–∞</option>
      </select>
      <label>–ë—é–¥–∂–µ—Ç (–≥—Ä–Ω)</label>
      <div style="display:flex; gap:8px;">
        <input id="minBudget" type="number" placeholder="–æ—Ç"/>
        <input id="maxBudget" type="number" placeholder="–¥–æ"/>
      </div>
      <label>–û–±—ä–µ–º –¥–≤–∏–≥–∞—Ç–µ–ª—è (–ª)</label>
      <input id="engine" type="number" step="0.1" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 2.0"/>
      <div class="actions">
        <button class="btn close" data-close="searchModal">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn" id="searchRun">–ü–æ–∏—Å–∫</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="offerModal">
    <div class="modal">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h3>
      <label>–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å</label>
      <input id="offerBrand" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä Hyundai Tucson"/>
      <label>–ì–æ—Ä–æ–¥</label>
      <input id="offerCity" placeholder="–í–∞—à –≥–æ—Ä–æ–¥"/>
      <label>–ö–æ–Ω—Ç–∞–∫—Ç</label>
      <input id="offerContact" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ Telegram"/>
      <label>–î–µ—Ç–∞–ª–∏ / –ë—é–¥–∂–µ—Ç</label>
      <textarea id="offerDetails" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥–æ 20 000$, 2018+, –∞–≤—Ç–æ–º–∞—Ç"></textarea>
      <div class="actions">
        <button class="btn close" data-close="offerModal">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn" id="offerSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="resultsModal">
    <div class="modal">
      <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h3>
      <div id="resultsList" style="display:grid; gap:8px;"></div>
      <div class="actions">
        <button class="btn" data-close="resultsModal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwMDcbys01OYEaS5Q6yJyDsZ9PuREpmGwGuFDDI76yrT9D1d3a0-Mq0ulnTk2IhLjm52A/exec";
    const cars = [
      {brand:'Hyundai',model:'Tucson',year:2018,transmission:'–∞–≤—Ç–æ–º–∞—Ç',engine:2.0,price:18000,city:'Kyiv',lat:50.45,lon:30.52},
      {brand:'BMW',model:'X3',year:2017,transmission:'–º–µ—Ö–∞–Ω–∏–∫–∞',engine:2.0,price:22000,city:'Lviv',lat:49.84,lon:24.03},
      {brand:'Toyota',model:'Camry',year:2020,transmission:'–∞–≤—Ç–æ–º–∞—Ç',engine:2.5,price:25000,city:'Odesa',lat:46.48,lon:30.73}
    ];
    const partners = [
      { name: 'Partner A', lat: 50.45, lon: 30.52 },
      { name: 'Partner B', lat: 49.84, lon: 24.03 },
      { name: 'Partner C', lat: 46.48, lon: 30.73 }
    ];

    const partnersLayer = document.getElementById('partners');
    const findBtn = document.getElementById('findBtn');
    const offerBtn = document.getElementById('offerBtn');
    const searchRun = document.getElementById('searchRun');
    const resultsList = document.getElementById('resultsList');

    function openModal(id) { document.getElementById(id).style.display = 'grid'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    document.querySelectorAll('.close').forEach(btn => btn.addEventListener('click', (e)=> closeModal(e.currentTarget.getAttribute('data-close'))));
    document.querySelectorAll('[data-close="resultsModal"]').forEach(btn => btn.addEventListener('click', ()=> closeModal('resultsModal')));

    let userPosition = null;
    function requestGeo() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(p => {
          userPosition = { lat: p.coords.latitude, lon: p.coords.longitude };
          layoutPartners();
        }, _ => layoutPartners());
      } else { layoutPartners(); }
    }

    function distanceKm(a,b) {
      const R=6371;
      const dLat=(b.lat-a.lat)*Math.PI/180;
      const dLon=(b.lon-a.lon)*Math.PI/180;
      const lat1=a.lat*Math.PI/180;
      const lat2=b.lat*Math.PI/180;
      const x=Math.sin(dLat/2)**2+Math.sin(dLon/2)**2*Math.cos(lat1)*Math.cos(lat2);
      return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
    }

    function layoutPartners() {
      partnersLayer.innerHTML = '';
      const rect = partnersLayer.getBoundingClientRect();
      const cy = rect.height / 2;
      const leftX = 52;
      const rightX = rect.width - 52;
      partners.forEach((p, i) => {
        let dist = 50;
        if (userPosition) dist = Math.max(1, Math.round(distanceKm(userPosition, p)));
        else dist = [6,12,25][i%3];
        const size = Math.max(42, Math.min(96, Math.round(160 / (1 + dist * 0.08))));
        const y = cy + (i-1)*110;
        const isLeft = i % 2 === 0;
        const x = isLeft ? leftX : rightX;
        const el = document.createElement('a');
        el.href = "#";
        el.className = "partner";
        el.style.width = size + "px";
        el.style.height = size + "px";
        el.style.left = (x - size/2) + "px";
        el.style.top = (y - size/2) + "px";
        el.style.animationDelay = (0.5 + i*0.12) + "s";
        el.setAttribute('data-tip', p.name + " ‚Äî " + dist + " –∫–º");
        el.innerHTML = `<span style="pointer-events:none;font-weight:800;font-size:${Math.max(12, size*0.24)}px;">${p.name.split(' ').map(w=>w[0]).join('')}</span>`;
        partnersLayer.appendChild(el);
      });
    }

    findBtn.addEventListener('click', ()=>{ openModal('searchModal'); requestGeo(); });
    offerBtn.addEventListener('click', ()=>{ openModal('offerModal'); requestGeo(); });

    searchRun.addEventListener('click', () => {
      const brand = (document.getElementById('brand').value||'').toLowerCase();
      const transmission = document.getElementById('transmission').value;
      const minBudget = parseFloat(document.getElementById('minBudget').value)||0;
      const maxBudget = parseFloat(document.getElementById('maxBudget').value)||Infinity;
      const engine = parseFloat(document.getElementById('engine').value)||0;

      let results = cars.filter(c =>
        (!brand || c.brand.toLowerCase().includes(brand)) &&
        (!transmission || c.transmission === transmission) &&
        c.price >= minBudget && c.price <= maxBudget &&
        (!engine || c.engine >= engine)
      );
      if (userPosition) results = results.map(c => ({...c, dist: Math.round(distanceKm(userPosition, {lat:c.lat, lon:c.lon}))})).sort((a,b)=>a.dist-b.dist);
      resultsList.innerHTML = results.length
        ? results.map(c => `<div style="border:1px solid #2a2a2a;border-left:3px solid var(--brand);padding:10px;border-radius:10px;background:#121212;">
            <strong>${c.brand} ${c.model}</strong><br/>
            ${c.year} ‚Ä¢ ${c.transmission} ‚Ä¢ ${c.engine} –ª ‚Ä¢ ${c.price}$ ‚Ä¢ ${c.city} ${c.dist?`‚Ä¢ ‚âà ${c.dist} –∫–º`:''}
          </div>`).join('')
        : `<p style="color:#bdbdbd;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>`;
      openModal('resultsModal');
    });

    document.getElementById('offerSend').addEventListener('click', async () => {
      const brand = document.getElementById('offerBrand').value.trim();
      const city = document.getElementById('offerCity').value.trim();
      const contact = document.getElementById('offerContact').value.trim();
      const details = document.getElementById('offerDetails').value.trim();
      const location = userPosition ? `${userPosition.lat.toFixed(5)}, ${userPosition.lon.toFixed(5)}` : '';

      try {
        const res = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            type: '–ü–∞—Ä—Ç–Ω—ë—Ä',
            brand, city, contact, details, location
          })
        });
        await res.text();
        alert('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –°–ø–∞—Å–∏–±–æ.');
        closeModal('offerModal');
      } catch (e) {
        alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ —Å–∫—Ä–∏–ø—Ç—É.');
      }
    });

    window.addEventListener('load', () => {
      requestGeo();
      window.addEventListener('resize', layoutPartners);
    });
  </script>
</body>
</html>
